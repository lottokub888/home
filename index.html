<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Lottery Web3 – Bitkub Chain</title>

<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<style>
:root{
--primary:#dc2626;--dark:#991b1b;--green:#16a34a;
--bg:#f8fafc;--card:#fff;--text:#111827
}
body{margin:0;font-family:system-ui;background:var(--bg)}
header{background:linear-gradient(90deg,var(--dark),var(--primary));color:#fff}
.container{max-width:1200px;margin:auto;padding:1.5rem}
.card{background:var(--card);border-radius:22px;padding:1.6rem;
box-shadow:0 20px 40px rgba(0,0,0,.1);margin-bottom:1.5rem}
button{border:none;border-radius:999px;padding:.6rem 1.4rem;
font-weight:700;cursor:pointer}
.primary{background:var(--primary);color:#fff}
.secondary{background:var(--green);color:#fff}
.ghost{background:#e5e7eb}
nav{display:flex;justify-content:space-between;align-items:center}
.wallet{display:flex;gap:.5rem;align-items:center;flex-wrap:wrap}
.pill{background:#111;color:#fff;padding:.3rem .8rem;
border-radius:999px;font-size:.8rem}
select{padding:.4rem;border-radius:999px}
.summary{white-space:pre-line;background:#fff1f2;
padding:1rem;border-radius:14px;font-weight:600}
</style>
</head>

<body>

<header>
  <div class="container">
    <nav>
      <b>Lottery Web3</b>
      <div class="wallet">
        <button class="ghost" onclick="connectWallet()">Connect MetaMask</button>
        <select onchange="switchNetwork(this.value)">
          <option value="">เลือกเครือข่าย</option>
          <option value="mainnet">KUB Mainnet</option>
          <option value="testnet">KUB Testnet</option>
        </select>
        <span id="addr" class="pill" style="display:none"></span>
        <span id="net" class="pill" style="display:none"></span>
      </div>
    </nav>
  </div>
</header>

<div class="container">

<div class="card">
  <h3>Wallet Info</h3>
  <p id="balance">Balance: -</p>
</div>

<div class="card">
  <h3>ทดลองซื้อสลาก</h3>
  <input id="num" placeholder="เลข 2 หรือ 3 ตัว">
  <input id="qty" type="number" min="1" value="1">
  <button class="secondary" onclick="add()">เพิ่มรายการ</button>
  <div class="summary" id="sum">ยังไม่มีรายการ</div>
</div>

</div>

<script>
/* ===== NETWORK CONFIG ===== */
const MAINNET={
 chainId:'0x8E4', // 2276
 chainName:'Bitkub Chain',
 nativeCurrency:{name:'KUB',symbol:'KUB',decimals:18},
 rpcUrls:['https://rpc.bitkubchain.io'],
 blockExplorerUrls:['https://www.kubscan.com']
};

const TESTNET={
 chainId:'0x8E5', // 2277
 chainName:'Bitkub Chain Testnet',
 nativeCurrency:{name:'tKUB',symbol:'tKUB',decimals:18},
 rpcUrls:['https://rpc-testnet.bitkubchain.io'],
 blockExplorerUrls:['https://testnet.kubscan.com']
};

let provider, signer, account;
let cart=[];

/* ===== CONNECT WALLET ===== */
async function connectWallet(){
 if(!window.ethereum){
   alert('กรุณาติดตั้ง MetaMask');
   return;
 }
 await ethereum.request({method:'eth_requestAccounts'});
 provider = new ethers.providers.Web3Provider(window.ethereum);
 signer = provider.getSigner();
 account = await signer.getAddress();

 addr.innerText = account.slice(0,6)+'...'+account.slice(-4);
 addr.style.display='inline-block';

 updateWallet();
}

/* ===== SWITCH NETWORK ===== */
async function switchNetwork(type){
 if(!window.ethereum || !type) return;
 const net = type==='mainnet'?MAINNET:TESTNET;
 try{
  await ethereum.request({
   method:'wallet_switchEthereumChain',
   params:[{chainId:net.chainId}]
  });
 }catch{
  await ethereum.request({
   method:'wallet_addEthereumChain',
   params:[net]
  });
 }
 provider = new ethers.providers.Web3Provider(window.ethereum);
 signer = provider.getSigner();
 updateWallet();
}

/* ===== UPDATE INFO ===== */
async function updateWallet(){
 const network = await provider.getNetwork();
 net.innerText = network.chainId===2276?'KUB Mainnet':'KUB Testnet';
 net.style.display='inline-block';

 const bal = await provider.getBalance(account);
 balance.innerText =
  'Balance: '+ethers.utils.formatEther(bal)+
  (network.chainId===2276?' KUB':' tKUB');
}

/* ===== DEMO BUY ===== */
function add(){
 const n=num.value.trim(); const q=+qty.value;
 if(!/^\d{2,3}$/.test(n)||q<1){
  alert('ข้อมูลไม่ถูกต้อง');return;
 }
 cart.push({n,q});
 sum.innerText = cart.map(i=>`${i.n} x ${i.q}`).join('\n');
}

/* ===== EVENTS ===== */
if(window.ethereum){
 ethereum.on('accountsChanged',()=>connectWallet());
 ethereum.on('chainChanged',()=>location.reload());
}
</script>

</body>
</html>
