<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Lottery Web3 – Bitkub Chain</title>

<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<style>
:root{
--red:#dc2626;--green:#16a34a;--bg:#f8fafc;
--dark:#0f172a;--card:#ffffff;--soft:#f1f5f9
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui;background:var(--bg);color:#111}
header{
background:linear-gradient(90deg,#7f1d1d,#dc2626,#ef4444);
color:#fff;padding:1.3rem
}
nav{margin-top:.8rem;display:flex;gap:.6rem;flex-wrap:wrap}
nav button{
background:rgba(255,255,255,.15);
border:none;color:#fff;padding:.5rem 1.3rem;
border-radius:999px;font-weight:600;cursor:pointer
}
nav button.active{background:#fff;color:#b91c1c}

.container{max-width:1200px;margin:auto;padding:2rem}
.card{
background:var(--card);border-radius:26px;
padding:2rem;box-shadow:0 30px 60px rgba(0,0,0,.12);
margin-bottom:2rem
}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1.6rem}

.btn{border:none;border-radius:999px;padding:.7rem 1.6rem;font-weight:700;cursor:pointer}
.primary{background:linear-gradient(90deg,#b91c1c,#ef4444);color:#fff}
.secondary{background:#16a34a;color:#fff}
.ghost{background:#e5e7eb}
.warn{background:#f59e0b}

input,select{
width:100%;padding:.75rem;border-radius:14px;
border:1px solid #ddd;margin-bottom:.7rem;font-size:1rem
}

.wallet{display:flex;gap:.6rem;flex-wrap:wrap;align-items:center}
.pill{
background:var(--dark);color:#fff;
border-radius:999px;padding:.35rem .9rem;font-size:.8rem
}
.badge-main{background:#2563eb}
.badge-test{background:#16a34a}
.muted{color:#64748b}

.summary{
background:#fff1f2;border-radius:18px;
padding:1.1rem;white-space:pre-line;font-weight:600
}

/* modal */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:99}
.modal-box{
background:#fff;border-radius:24px;
padding:1.6rem;max-width:580px;width:92%;
max-height:80vh;overflow:auto
}
.num-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(62px,1fr));gap:12px}
.num{
background:var(--soft);border-radius:14px;
padding:.8rem;text-align:center;font-weight:700;cursor:pointer
}
.num.active{background:#16a34a;color:#fff}

footer{text-align:center;color:#64748b;padding:2rem;font-size:.9rem}
</style>
</head>

<body>

<header>
<h1>แพลตฟอร์มซื้อสลาก (Web3)</h1>
<nav>
<button class="active" onclick="showPage('home',this)">หน้าแรก</button>
<button onclick="showPage('buy',this)">ซื้อสลาก</button>
<button onclick="showPage('wallet',this)">Wallet</button>
<button onclick="showPage('about',this)">ข้อมูล</button>
</nav>
</header>

<div class="container">

<section id="home" class="card">
<h2>Bitkub Chain Mainnet & Testnet</h2>
<p class="muted">
แพลตฟอร์มตัวอย่างระดับ Startup รองรับ Web3  
เชื่อมต่อ MetaMask | แสดงยอด | โอน KUB / tKUB
</p>
</section>

<section id="buy" class="card" style="display:none">
<h2>เลือกซื้อสลาก</h2>

<div class="grid">
<div>
<h3>กรอกเลข</h3>
<input id="num" placeholder="เลข 2 หรือ 3 ตัว">
<input id="qty" type="number" min="1" value="1">
<button class="secondary" onclick="addManual()">เพิ่มรายการ</button>
</div>

<div>
<h3>ตารางตัวเลข</h3>
<button class="ghost" onclick="openTable(2)">เลข 2 ตัว</button>
<button class="ghost" onclick="openTable(3)">เลข 3 ตัว</button>
</div>
</div>

<button class="primary" style="margin-top:1rem" onclick="renderSummary()">สรุปรายการ</button>
<div id="summary" class="summary" style="margin-top:1rem"></div>
</section>

<section id="wallet" class="card" style="display:none">
<h2>Wallet</h2>

<div class="wallet">
<button class="primary" onclick="connectWallet()">Connect MetaMask</button>
<button class="ghost" onclick="switchNetwork()">สลับเครือข่าย</button>
<span id="addr" class="pill" style="display:none"></span>
<span id="net" class="pill"></span>
</div>

<div class="grid">
<div class="card">
<h3>ยอดคงเหลือ</h3>
<p id="bal">-</p>
<button class="ghost" onclick="refreshBalance()">Refresh</button>
</div>

<div class="card">
<h3>ชำระเงิน</h3>
<p id="payTotal" class="muted"></p>
<button class="warn" onclick="pay()">ยืนยันโอน</button>
<pre id="tx" class="muted"></pre>
</div>
</div>
</section>

<section id="about" class="card" style="display:none">
<ul>
<li>รองรับ Bitkub Chain Mainnet / Testnet</li>
<li>เชื่อมต่อผ่าน MetaMask</li>
<li>เหมาะสำหรับ Prototype / Demo</li>
</ul>
</section>

</div>

<footer>© Web3 Lottery Platform</footer>

<!-- MODAL -->
<div id="modal" class="modal" onclick="closeModal(event)">
<div class="modal-box">
<h3 id="mtitle"></h3>
<div id="grid" class="num-grid"></div>
<input id="mqty" type="number" min="1" value="1">
<button class="secondary" onclick="confirmTable()">เพิ่มรายการ</button>
</div>
</div>

<script>
/* ========= CONFIG ========= */
const PRICE = 0.00000020;
const DEST = '0xa7488ce82af54e534c16f94dbf6d9ea9c0809de8';

const MAINNET={
chainId:'0x8E4',
chainName:'Bitkub Chain',
nativeCurrency:{name:'KUB',symbol:'KUB',decimals:18},
rpcUrls:['https://rpc.bitkubchain.io'],
blockExplorerUrls:['https://www.kubscan.com']
};

const TESTNET={
chainId:'0x8E5',
chainName:'Bitkub Chain Testnet',
nativeCurrency:{name:'tKUB',symbol:'tKUB',decimals:18},
rpcUrls:['https://rpc-testnet.bitkubchain.io'],
blockExplorerUrls:['https://testnet.kubscan.com']
};

/* ========= STATE ========= */
let cart=[], tableType=2, selected=[];
let provider, signer, account, currentNet='test';

/* ========= UI ========= */
function showPage(id,btn){
document.querySelectorAll('section').forEach(s=>s.style.display='none');
document.getElementById(id).style.display='block';
document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
btn.classList.add('active');
}

function addManual(){
if(!(num.value.length===2||num.value.length===3)) return alert('เลขไม่ถูกต้อง');
cart.push({n:num.value,q:+qty.value});
alert('เพิ่มแล้ว');
}

function renderSummary(){
let sets=0,s='';
cart.forEach(i=>{sets+=i.q;s+=`${i.n} x ${i.q}\n`;});
const total=sets*PRICE;
summary.innerText=s+`\nรวม ${sets} ชุด\n${total} ${currentNet==='main'?'KUB':'tKUB'}`;
payTotal.innerText=`ยอดที่ต้องชำระ: ${total}`;
}

/* ========= TABLE ========= */
function openTable(t){
tableType=t;selected=[];modal.style.display='flex';grid.innerHTML='';
mtitle.innerText=`ตารางเลข ${t} ตัว`;
let max=t===2?100:1000;
for(let i=0;i<max;i++){
let n=String(i).padStart(t,'0');
let d=document.createElement('div');
d.className='num';d.innerText=n;
d.onclick=()=>{d.classList.toggle('active');
selected.includes(n)?selected.splice(selected.indexOf(n),1):selected.push(n)};
grid.appendChild(d);
}
}
function confirmTable(){
selected.forEach(n=>cart.push({n,q:+mqty.value}));
modal.style.display='none';
}
function closeModal(e){if(e.target.id==='modal')modal.style.display='none'}

/* ========= WEB3 ========= */
async function connectWallet(){
await ethereum.request({method:'eth_requestAccounts'});
provider=new ethers.providers.Web3Provider(window.ethereum,'any');
signer=provider.getSigner();
account=await signer.getAddress();
addr.innerText=account.slice(0,6)+'...'+account.slice(-4);
addr.style.display='inline-block';
await detectNetwork();
await refreshBalance();
}

async function detectNetwork(){
const net=await provider.getNetwork();
currentNet=net.chainId===2276?'main':'test';
net.innerText=currentNet==='main'?'MAINNET':'TESTNET';
net.className='pill '+(currentNet==='main'?'badge-main':'badge-test');
}

async function switchNetwork(){
const cfg=currentNet==='main'?TESTNET:MAINNET;
try{
await ethereum.request({method:'wallet_switchEthereumChain',params:[{chainId:cfg.chainId}]});
}catch{
await ethereum.request({method:'wallet_addEthereumChain',params:[cfg]});
}
}

async function refreshBalance(){
const b=await provider.getBalance(account);
bal.innerText=ethers.utils.formatEther(b)+' '+(currentNet==='main'?'KUB':'tKUB');
}

async function pay(){
let sets=cart.reduce((a,b)=>a+b.q,0);
if(!sets) return alert('ไม่มีรายการ');
const total=sets*PRICE;
const tx=await signer.sendTransaction({
to:DEST,
value:ethers.utils.parseEther(total.toString())
});
txEl.innerText=tx.hash;
}

/* ========= EVENTS ========= */
if(window.ethereum){
ethereum.on('chainChanged',()=>connectWallet());
ethereum.on('accountsChanged',()=>connectWallet());
}
</script>

</body>
</html>
