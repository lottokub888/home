<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lottery Web3 Prototype (Startup Demo)</title>

  <!-- Ethers v5 -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

  <style>
    :root{
      --red:#ef4444;--green:#22c55e;--gray:#f3f4f6;--dark:#111827;--card:#ffffff
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto;background:linear-gradient(180deg,#fff5f5,#f9fafb);color:#111}

    header{background:linear-gradient(90deg,#7f1d1d,#dc2626,#ef4444);color:#fff;padding:1.2rem}
    header h1{margin:0;font-size:1.6rem}
    nav{margin-top:.6rem;display:flex;flex-wrap:wrap;gap:.4rem}
    nav button{background:rgba(255,255,255,.15);border:none;color:#fff;padding:.45rem 1.1rem;border-radius:999px;font-weight:600;cursor:pointer}
    nav button.active{background:#fff;color:#b91c1c}

    .container{max-width:1200px;margin:auto;padding:2rem}
    .card{background:var(--card);border-radius:26px;padding:2rem;box-shadow:0 25px 50px rgba(0,0,0,.12);margin-bottom:2rem}
    h2{margin-top:0}

    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:1.5rem}

    .btn{border:none;border-radius:999px;padding:.7rem 1.6rem;font-weight:600;cursor:pointer}
    .primary{background:linear-gradient(90deg,#b91c1c,#ef4444);color:#fff}
    .secondary{background:#16a34a;color:#fff}
    .ghost{background:#e5e7eb}
    .warn{background:#f59e0b;color:#111}

    input,select{width:100%;padding:.7rem;border-radius:14px;border:1px solid #ddd;margin-bottom:.6rem;font-size:1rem}

    .tabs{display:flex;gap:.5rem;margin-bottom:1rem}
    .tab{flex:1;padding:.5rem;border-radius:999px;border:none;font-weight:600;background:#f3f4f6;cursor:pointer}
    .tab.active{background:#dc2626;color:#fff}

    .summary{background:#fef2f2;padding:1rem;border-radius:18px;white-space:pre-line;font-weight:600}

    footer{text-align:center;color:#666;padding:2rem;font-size:.9rem}

    /* modal */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:99}
    .modal-box{background:#fff;border-radius:22px;padding:1.5rem;max-width:560px;width:90%;max-height:80vh;overflow:auto}
    .num-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(60px,1fr));gap:10px;margin-top:1rem}
    .num{background:#f3f4f6;border-radius:14px;padding:.7rem;text-align:center;font-weight:600;cursor:pointer}
    .num.active{background:#16a34a;color:#fff}

    .badge{display:inline-block;padding:.2rem .7rem;border-radius:999px;font-size:.75rem;font-weight:700}
    .legal{background:#dcfce7;color:#166534}
    .demo{background:#e5e7eb;color:#111}

    .wallet{display:flex;flex-wrap:wrap;gap:.6rem;align-items:center}
    .pill{background:#111827;color:#fff;border-radius:999px;padding:.3rem .8rem;font-size:.8rem}
    .muted{color:#6b7280}
  </style>
</head>
<body>

<header>
  <h1>Lottery Web3 Prototype</h1>
  <nav>
    <button class="active" onclick="showPage('home',this)">หน้าแรก</button>
    <button onclick="showPage('buy',this)">เลือกซื้อ</button>
    <button onclick="showPage('web3',this)">Web3 / Wallet</button>
    <button onclick="showPage('about',this)">แนวคิด & กฎหมาย</button>
  </nav>
</header>

<div class="container">

  <!-- HOME -->
  <section id="home" class="card">
    <h2>Prototype ระดับ Startup (Web2 + Web3)</h2>
    <p>
      <b>Demo สำหรับเสนอหน่วยงาน / นักลงทุน</b><br>
      - Mainnet: <b>Simulate Payment เท่านั้น</b><br>
      - Testnet: <b>โอน tKUB ได้จริง</b>
    </p>
    <span class="badge legal">Legal-safe Prototype</span>
    <span class="badge demo">No real payment on Mainnet</span>
  </section>

  <!-- BUY -->
  <section id="buy" class="card" style="display:none">
    <h2>เลือกซื้อ (Demo UX)</h2>

    <div class="tabs">
      <button class="tab active" onclick="tab('two',this)">เลข 2 ตัว</button>
      <button class="tab" onclick="tab('three',this)">เลข 3 ตัว</button>
    </div>

    <div id="two">
      <input id="num2" maxlength="2" placeholder="เลข 2 ตัว เช่น 45" />
      <input id="qty2" type="number" min="1" value="1" placeholder="จำนวนชุด (บาทละ 100)" />
      <div class="wallet">
        <button class="secondary" onclick="add(2)">ซื้อเพิ่ม</button>
        <button class="ghost" onclick="openTable(2)">ตารางเลข</button>
      </div>
    </div>

    <div id="three" style="display:none">
      <input id="num3" maxlength="3" placeholder="เลข 3 ตัว เช่น 456" />
      <input id="qty3" type="number" min="1" value="1" placeholder="จำนวนชุด (บาทละ 100)" />
      <div class="wallet">
        <button class="secondary" onclick="add(3)">ซื้อเพิ่ม</button>
        <button class="ghost" onclick="openTable(3)">ตารางเลข</button>
      </div>
    </div>

    <div style="margin-top:1rem">
      <button class="primary" onclick="summary()">สรุปรายการ</button>
    </div>

    <div id="summary" class="summary" style="margin-top:1rem"></div>
  </section>

  <!-- WEB3 -->
  <section id="web3" class="card" style="display:none">
    <h2>Web3 / MetaMask</h2>

    <div class="wallet">
      <button class="primary" onclick="connectWallet()">Connect MetaMask</button>
      <span id="addr" class="pill" style="display:none"></span>
      <span id="net" class="pill" style="display:none"></span>
    </div>

    <p class="muted">รองรับ Bitkub Chain Mainnet & Testnet</p>

    <div class="grid">
      <div class="card">
        <h3>ยอดคงเหลือ</h3>
        <p id="bal">-</p>
        <button class="ghost" onclick="refreshBalance()">Refresh</button>
      </div>

      <div class="card">
        <h3>ชำระเงิน (Prototype)</h3>
        <select id="mode">
          <option value="simulate">Mainnet: Simulate</option>
          <option value="testnet">Testnet: โอนจริง (tKUB)</option>
        </select>
        <input id="amount" type="number" step="0.0001" placeholder="จำนวน KUB / tKUB" />
        <button class="warn" onclick="pay()">ยืนยัน</button>
        <p class="muted">ปลายทาง: 0xa7488ce82af54e534c16f94dbf6d9ea9c0809de8</p>
        <pre id="tx" class="muted"></pre>
      </div>
    </div>
  </section>

  <!-- ABOUT -->
  <section id="about" class="card" style="display:none">
    <h2>แนวคิด & กฎหมาย</h2>
    <ul>
      <li>Mainnet แสดงเฉพาะ Simulation (ไม่โอนจริง)</li>
      <li>Testnet ใช้เพื่อทดสอบเทคโนโลยี</li>
      <li>ไม่รับเงินจริง / ไม่เป็นผู้ขาย</li>
    </ul>
  </section>

</div>

<footer>
  © Web3 Lottery Prototype
</footer>

<!-- MODAL -->
<div id="modal" class="modal" onclick="closeModal(event)">
  <div class="modal-box">
    <h3 id="mtitle"></h3>
    <div class="num-grid" id="grid"></div>
    <input id="mqty" type="number" min="1" value="1" />
    <button class="secondary" onclick="confirmTable()">เพิ่มรายการ</button>
  </div>
</div>

<script>
  // ====== UI / BUY ======
  let cart=[],type=2,selected=[];
  function showPage(id,btn){document.querySelectorAll('section').forEach(s=>s.style.display='none');document.getElementById(id).style.display='block';document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));btn.classList.add('active')}
  function tab(id,btn){two.style.display=id==='two'?'block':'none';three.style.display=id==='three'?'block':'none';document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));btn.classList.add('active')}
  function add(t){const n=t===2?num2.value:num3.value;const q=t===2?+qty2.value:+qty3.value;if(n.length!==t||q<1){alert('ข้อมูลไม่ถูกต้อง');return;}cart.push({t,n,q});alert('เพิ่มแล้ว')}
  function summary(){let s='',sum=0;cart.forEach(i=>{let m=i.q*100;sum+=m;s+=`${i.t} ตัว ${i.n} x ${i.q} = ${m} บาท\n`});summaryEl().innerText=s+`\nรวม ${sum} บาท`}
  function summaryEl(){return document.getElementById('summary')}
  function openTable(t){type=t;selected=[];modal.style.display='flex';grid.innerHTML='';mtitle.innerText=`ตารางเลข ${t} ตัว`;let max=t===2?100:1000;for(let i=0;i<max;i++){let n=String(i).padStart(t,'0');let d=document.createElement('div');d.className='num';d.innerText=n;d.onclick=()=>{d.classList.toggle('active');selected.includes(n)?selected.splice(selected.indexOf(n),1):selected.push(n)};grid.appendChild(d)}}
  function confirmTable(){let q=+mqty.value;if(selected.length===0||q<1){alert('เลือกเลข');return;}selected.forEach(n=>cart.push({t:type,n,q}));modal.style.display='none'}
  function closeModal(e){if(e.target.id==='modal')modal.style.display='none'}

  // ====== WEB3 ======
  const DEST='0xa7488ce82af54e534c16f94dbf6d9ea9c0809de8';
  let provider, signer, account;

  const KUB_MAINNET={
    chainId:'0x8E4', // 2276
    chainName:'Bitkub Chain',
    nativeCurrency:{name:'KUB',symbol:'KUB',decimals:18},
    rpcUrls:['https://rpc.bitkubchain.io'],
    blockExplorerUrls:['https://www.kubscan.com']
  };
  const KUB_TESTNET={
    chainId:'0x8E5', // 2277
    chainName:'Bitkub Chain Testnet',
    nativeCurrency:{name:'tKUB',symbol:'tKUB',decimals:18},
    rpcUrls:['https://rpc-testnet.bitkubchain.io'],
    blockExplorerUrls:['https://testnet.kubscan.com']
  };

  async function connectWallet(){
    if(!window.ethereum){alert('กรุณาติดตั้ง MetaMask');return}
    await ethereum.request({method:'eth_requestAccounts'});
    provider=new ethers.providers.Web3Provider(window.ethereum);
    signer=provider.getSigner();
    account=await signer.getAddress();
    addr.innerText=account.slice(0,6)+'...'+account.slice(-4);addr.style.display='inline-block';
    await refreshNetwork();
    await refreshBalance();
  }

  async function refreshNetwork(){
    const n=await provider.getNetwork();
    net.innerText=n.chainId===2276?'Mainnet':'Testnet';net.style.display='inline-block';
  }

  async function refreshBalance(){
    if(!provider) return;
    const b=await provider.getBalance(account);
    const n=await provider.getNetwork();
    const sym=n.chainId===2276?'KUB':'tKUB';
    bal.innerText=ethers.utils.formatEther(b)+' '+sym;
  }

  async function switchTo(chain){
    const params=chain==='main'?KUB_MAINNET:KUB_TESTNET;
    try{await ethereum.request({method:'wallet_switchEthereumChain',params:[{chainId:params.chainId}]});}
    catch(e){await ethereum.request({method:'wallet_addEthereumChain',params:[params]});}
  }

  async function pay(){
    if(!provider){alert('เชื่อม Wallet ก่อน');return}
    const amt=amount.value; if(!amt||+amt<=0){alert('กรอกจำนวน');return}
    const mode=document.getElementById('mode').value;
    const netw=await provider.getNetwork();

    if(mode==='simulate' || netw.chainId===2276){
      tx.innerText=`SIMULATED PAYMENT\nAmount: ${amt}\nTo: ${DEST}\nNetwork: Mainnet`;
      return;
    }

    // Testnet real transfer
    if(netw.chainId!==2277){await switchTo('test');}
    const txr=await signer.sendTransaction({to:DEST,value:ethers.utils.parseEther(amt)});
    tx.innerText=`TX SENT (Testnet)\nHash: ${txr.hash}`;
  }
</script>

</body>
</html>
