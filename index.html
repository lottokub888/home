<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Lottery Web3 | KUB Mainnet & Testnet</title>

<!-- ethers -->
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<style>
body{margin:0;font-family:system-ui;background:#f8fafc}
header{background:linear-gradient(90deg,#991b1b,#dc2626);color:#fff;padding:1.2rem}
.container{max-width:1100px;margin:auto;padding:1.5rem}
.card{background:#fff;border-radius:20px;padding:1.5rem;
box-shadow:0 15px 35px rgba(0,0,0,.12);margin-bottom:1.5rem}
button{border:none;border-radius:999px;padding:.6rem 1.5rem;
font-weight:700;cursor:pointer}
.primary{background:#dc2626;color:#fff}
.secondary{background:#16a34a;color:#fff}
.ghost{background:#e5e7eb}
.wallet-box{display:flex;gap:.5rem;flex-wrap:wrap;align-items:center}
.pill{background:#111827;color:#fff;padding:.3rem .8rem;border-radius:999px;font-size:.8rem}
.balance{font-weight:700;font-size:1.1rem}
select{padding:.5rem;border-radius:999px;border:1px solid #ddd}
</style>
</head>

<body>

<header>
  <div class="container">
    <h2>Lottery Web3 Prototype</h2>
  </div>
</header>

<div class="container">

  <div class="card">
    <h3>Wallet</h3>
    <div class="wallet-box">
      <button class="primary" onclick="connectWallet()">Connect MetaMask</button>

      <select id="networkSelect" onchange="switchNetwork(this.value)">
        <option value="">เลือกเครือข่าย</option>
        <option value="mainnet">KUB Mainnet</option>
        <option value="testnet">KUB Testnet</option>
      </select>

      <span id="address" class="pill" style="display:none"></span>
      <span id="network" class="pill" style="display:none"></span>
    </div>

    <p class="balance" id="balance">Balance: -</p>
  </div>

</div>

<script>
/* ========== NETWORK CONFIG ========== */
const KUB_MAINNET = {
  chainId: '0x8E4', // 2276
  chainName: 'Bitkub Chain',
  nativeCurrency: { name: 'KUB', symbol: 'KUB', decimals: 18 },
  rpcUrls: ['https://rpc.bitkubchain.io'],
  blockExplorerUrls: ['https://www.kubscan.com']
};

const KUB_TESTNET = {
  chainId: '0x8E5', // 2277
  chainName: 'Bitkub Chain Testnet',
  nativeCurrency: { name: 'tKUB', symbol: 'tKUB', decimals: 18 },
  rpcUrls: ['https://rpc-testnet.bitkubchain.io'],
  blockExplorerUrls: ['https://testnet.kubscan.com']
};

/* ========== STATE ========== */
let provider, signer, account;

/* ========== CONNECT ========== */
async function connectWallet(){
  if(!window.ethereum){
    alert('กรุณาติดตั้ง MetaMask');
    return;
  }

  await ethereum.request({ method:'eth_requestAccounts' });

  provider = new ethers.providers.Web3Provider(window.ethereum,'any');
  signer = provider.getSigner();
  account = await signer.getAddress();

  document.getElementById('address').innerText =
    account.slice(0,6)+'...'+account.slice(-4);
  document.getElementById('address').style.display='inline-block';

  await updateNetwork();
  await updateBalance();
}

/* ========== SWITCH NETWORK ========== */
async function switchNetwork(net){
  if(!window.ethereum) return;

  const params = net==='mainnet' ? KUB_MAINNET : KUB_TESTNET;

  try{
    await ethereum.request({
      method:'wallet_switchEthereumChain',
      params:[{ chainId: params.chainId }]
    });
  }catch(e){
    await ethereum.request({
      method:'wallet_addEthereumChain',
      params:[params]
    });
  }

  provider = new ethers.providers.Web3Provider(window.ethereum,'any');
  signer = provider.getSigner();
  await updateNetwork();
  await updateBalance();
}

/* ========== UPDATE UI ========== */
async function updateNetwork(){
  const net = await provider.getNetwork();
  const name = net.chainId===2276 ? 'KUB Mainnet' : 'KUB Testnet';
  document.getElementById('network').innerText = name;
  document.getElementById('network').style.display='inline-block';
}

async function updateBalance(){
  if(!provider || !account) return;
  const bal = await provider.getBalance(account);
  const net = await provider.getNetwork();
  const sym = net.chainId===2276 ? 'KUB' : 'tKUB';
  document.getElementById('balance').innerText =
    'Balance: '+ethers.utils.formatEther(bal)+' '+sym;
}

/* ========== EVENTS ========== */
if(window.ethereum){
  ethereum.on('accountsChanged', connectWallet);
  ethereum.on('chainChanged', ()=>{
    provider = new ethers.providers.Web3Provider(window.ethereum,'any');
    updateNetwork(); updateBalance();
  });
}
</script>

</body>
</html>
